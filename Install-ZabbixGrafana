#Instalação do Zabbix 4.4, Mysql e Nginx / OS. CentOS8

rpm -Uvh https://repo.zabbix.com/zabbix/4.4/rhel/8/x86_64/zabbix-release-4.4-1.el8.noarch.rpm
dnf clean all
dnf install zabbix-server-mysql zabbix-web-mysql zabbix-nginx-conf zabbix-agent 

#Instala Mysql
dnf install mysql mysql-server 
#No centos7
yum install mariadb mariadb-server -y; systemctl start mariadb
systemctl start mysqld # Iniciar o serviço
systemctl enable mysqld

#Configuração das tabelas MYSQL
mysql -uroot -p #não precisa de senha no momento
create database zabbixdb character set utf8 collate utf8_bin;
create user 'zabbix'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
#outra forma de criar usuário: 
CREATE USER 'zabbix'@'localhost' IDENTIFIED BY 'minhasenha';

grant all on zabbixdb.* to 'zabbix'@'localhost';
FLUSH PRIVILEGES
quit;

#Adicional verificar os usuários do mysql
SELECT user FROM mysql.user;

#Importar as tabelas Zabbix
zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix

#Configuração de arquivos
#Edit file /etc/zabbix/zabbix_server.conf 
DBPassword=password
#Edit file /etc/nginx/conf.d/zabbix.conf, uncomment and set 'listen' and 'server_name' directives.
listen 80;
server_name <IP SERVIDOR>;
#Edit file /etc/php-fpm.d/zabbix.conf, uncomment and set the right timezone for you. 
; php_value[date.timezone] = America/Manaus
#Start Zabbix server and agent processes and make it start at system boot.
systemctl restart zabbix-server zabbix-agent nginx php-fpm
systemctl enable zabbix-server zabbix-agent nginx php-fpm

#Entrar na página <ip> e configurar o password e acessar a págiana
#login Admin
#senha zabbix

#MIGRAÇÃO ZABBIX PARA UMA OUTRA VERSÃO
#Configuração de uma versão superior
#

#Instalação e configuração do Grafana
dnf install wget
wget https://dl.grafana.com/oss/release/grafana-6.7.2-1.x86_64.rpm
yum install grafana-6.7.2-1.x86_64.rpm
systemctl enable grafana-server
systemctl start grafana-server
#Pela url do <ip>:3000 alteirar a senha e acessar o pagina do grafana
#login admin
#login admin

#Instalar Plugin Zabbix
grafana-cli plugins install alexanderzobnin-zabbix-app
systemctl restart grafana-serve

#configurar url do plugin e incluir a senha
#capo URL: http://<ip>/api_jsonrpc.php
#Access: Browser
#Adicionar o login e senha do zabbix
#Escolher a versão do Zabbix

#Instalação do Zabbix na função de proxy

#Baixar o repositório no site da Zabbix
rpm -Uvh https://repo.zabbix.com/zabbix/4.4/rhel/8/x86_64/zabbix-release-4.4-1.el8.noarch.rpm

#Instalar e configurar o Mysql, nas mesmas configurações sugeridas na instalação do Zabbix principal

#Importar as tabelas mysql
zcat /usr/share/doc/zabbix-proxy-mysql*/schema.sql.gz | mysql -uzabbix -p zabbix

#Configuração de arquivos
#Edit file /etc/zabbix/zabbix_proxy.conf
Server=<ip do zabbix principal>
Hostname=<nome do servidor>
DBName=zabbix
DBUser=zabbix
DBPassword=password

#Edit file /etc/zabbix/zabbix_agentd.conf
Server=<ip servidor>
Hostname=<noem>

#cadastrar o zabbix-proxy na pagina do zabbix em "adminsitração / proxy"






