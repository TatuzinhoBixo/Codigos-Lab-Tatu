#Instalação do Zabbix 4.4, Mysql e Nginx / OS. CentOS8

rpm -Uvh https://repo.zabbix.com/zabbix/4.4/rhel/8/x86_64/zabbix-release-4.4-1.el8.noarch.rpm
dnf clean all
dnf install zabbix-server-mysql zabbix-web-mysql zabbix-nginx-conf zabbix-agent 

#Instala Mysql
dnf install mysql mysql-server 
systemctl start mysqld # Iniciar o serviço
systemctl enable mysqld

#Configuração das tabelas MYSQL
mysql -uroot -p #não precisa de senha no momento
create database zabbix character set utf8 collate utf8_bin;
create user 'zabbix'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
grant all on zabbix.* to 'zabbix'@'localhost'; 
quit;

#Importar as tabelas Zabbix
zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix

#Configuração de arquivos
#Edit file /etc/zabbix/zabbix_server.conf 
DBPassword=password
#Edit file /etc/nginx/conf.d/zabbix.conf, uncomment and set 'listen' and 'server_name' directives.
listen 80;
server_name <IP SERVIDOR>;
#Edit file /etc/php-fpm.d/zabbix.conf, uncomment and set the right timezone for you. 
; php_value[date.timezone] = America/Manaus
#Start Zabbix server and agent processes and make it start at system boot.
systemctl restart zabbix-server zabbix-agent nginx php-fpm
systemctl enable zabbix-server zabbix-agent nginx php-fpm

#Entrar na página <ip> e configurar o password e acessar a págian
#login Admin
#senha zabbix

#Instalação e configuração do Grafana
dnf install wget
wget https://dl.grafana.com/oss/release/grafana-6.7.2-1.x86_64.rpm
yum install grafana-6.7.2-1.x86_64.rpm
systemctl enable grafana-server
systemctl start grafana-server
#Pela url do <ip>:3000 alteirar a senha e acessar o pagina do grafana
#login admin
#login admin

#Instalar Plugin Zabbix
grafana-cli plugins install alexanderzobnin-zabbix-app
systemctl restart grafana-serve

#configurar url do plugin e incluir a senha
http://<ip>/api_jsonrpc.php
